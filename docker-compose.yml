# filepath: c:\Users\movin\FYP\sinXdetect\docker-compose.yml
# SinXdetect Production Docker Compose
#
# Usage:
#   docker compose up --build -d --remove-orphans
#   docker compose down --remove-orphans
#
# Note: Use --remove-orphans to clean up old containers from previous config

services:
  # Combined sinXdetect Application (Frontend + Backend)
  # Uses the unified multi-stage Dockerfile
  sinxdetect:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - VITE_API_URL=http://localhost:8000
    container_name: sinxdetect-app
    ports:
      - '3000:80'
    environment:
      - MODEL_PATH=/app/ml/models/sinbert_sinhala_classifier
      - PYTHONUNBUFFERED=1
      - UVICORN_WORKERS=1
    networks:
      - sinxdetect-network
    restart: unless-stopped
    healthcheck:
      test:
        [
          'CMD',
          'wget',
          '--quiet',
          '--tries=1',
          '--spider',
          'http://localhost:80/',
        ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 180s

networks:
  sinxdetect-network:
    driver: bridge
