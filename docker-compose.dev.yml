# filepath: c:\Users\movin\FYP\sinXdetect\docker-compose.dev.yml
# Development-specific docker-compose configuration
#
# Usage:
#   docker compose -f docker-compose.dev.yml up --build --remove-orphans
#   docker compose -f docker-compose.dev.yml down --remove-orphans
#
# For development, we run backend and frontend separately for hot-reload support

services:
  # Override: Disable the combined service for dev mode
  sinxdetect:
    profiles:
      - production-only

  # Backend Service with hot-reload
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: sinxdetect-backend-dev
    ports:
      - '8000:8000'
    volumes:
      # Mount source code for hot-reload
      - ./backend:/app
      - ./ml/models:/app/ml/models:ro
    environment:
      - MODEL_PATH=/app/ml/models/sinbert_sinhala_classifier
      - PYTHONUNBUFFERED=1
      - DEBUG=1
    command:
      ['uvicorn', 'app:app', '--host', '0.0.0.0', '--port', '8000', '--reload']
    networks:
      - sinxdetect-network
    restart: unless-stopped

  # Frontend Service with Vite dev server
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    container_name: sinxdetect-frontend-dev
    ports:
      - '5173:5173'
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      - VITE_API_URL=http://localhost:8000
    command: ['npm', 'run', 'dev', '--', '--host']
    depends_on:
      - backend
    networks:
      - sinxdetect-network
    restart: unless-stopped

networks:
  sinxdetect-network:
    driver: bridge
